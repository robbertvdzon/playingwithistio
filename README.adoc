= PLAYING WITH ISTIO


== Install minishift:
```
brew cask install minishift
brew cask reinstall minishift
minishift start --memory 8GB
```
(login op https://192.168.64.6:8443/console als developer/anypass  of syste/admin )

== Installing Minishift and Istio
```
curl -L https://git.io/getLatestIstio | sh -
export PATH="$PATH:/Users/robbert/istio-1.0.6/bin"
cd istio-1.0.6/
oc login -u system:admin

oc adm policy add-scc-to-user anyuid -z istio-egressgateway-service-account -n istio-system
oc adm policy add-scc-to-user anyuid -z istio-citadel-service-account -n istio-system
oc adm policy add-scc-to-user anyuid -z istio-ingressgateway-service-account -n istio-system
oc adm policy add-scc-to-user anyuid -z istio-cleanup-old-ca-service-account -n istio-system
oc adm policy add-scc-to-user anyuid -z istio-mixer-post-install-account -n istio-system
oc adm policy add-scc-to-user anyuid -z istio-mixer-service-account -n istio-system
oc adm policy add-scc-to-user anyuid -z istio-pilot-service-account -n istio-system
oc adm policy add-scc-to-user anyuid -z istio-sidecar-injector-service-account -n istio-system
oc adm policy add-scc-to-user anyuid -z default -n istio-system
oc adm policy add-scc-to-user anyuid -z istio-galley-service-account -n istio-system
oc adm policy add-scc-to-user anyuid -z prometheus -n istio-system

oc apply -f install/kubernetes/helm/istio/templates/crds.yaml
oc apply -f install/kubernetes/istio-demo-auth.yaml
oc project istio-system
oc get svc -n istio-system
oc get pods -n istio-system

#
kubectl label namespace default istio-injection=enabled --overwrite
```

== Test 1 : Deploy sample pods without sidecar
```
cd service1
./mvnw package

oc login https://192.168.64.8:8443 --token=XXXXXXXXXX (copy from web)
eval $(minishift docker-env)
docker build -t service1:v1 .
minishift ssh docker images | grep service1
oc create -f openshift-scripts/deployconfig.yml -n myproject

```

== Test 2 : Remove sample pods
oc delete -f openshift-scripts/deployconfig.yml -n myproject


== Test 3: Deploy sample pods with sidecar
```
cd service1
./mvnw package

oc login https://192.168.64.8:8443 --token=XXXXXXXXXX (copy from web)
eval $(minishift docker-env)
docker build -t service1:v1 .
minishift ssh docker images | grep service1

export PATH="$PATH:~/istio-1.0.6/bin"
kubectl label namespace default istio-injection=enabled --overwrite
istioctl kube-inject -f openshift-scripts/deployconfig.yml | oc create -n myproject -f -

```


== Delete Istio on minishift:
```
oc delete -f install/kubernetes/istio-demo-auth.yaml
```

== Delete minishift:
```
minishift delete
rm -rf ~.minishift/
rm -rf ~/.kube
```




== References:
link:https://istio.io/docs/setup/kubernetes/quick-start[https://istio.io/docs/setup/kubernetes/quick-start/] +
link:https://medium.com/devopslinks/istio-step-by-step-part-01-introduction-to-istio-b9fd0df30a9e[https://medium.com/devopslinks/istio-step-by-step-part-01-introduction-to-istio-b9fd0df30a9e] +
link:https://developers.redhat.com/books/introducing-istio-service-mesh-microservices/[https://developers.redhat.com/books/introducing-istio-service-mesh-microservices/]

